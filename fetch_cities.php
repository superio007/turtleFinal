<?php
$australianCities = array(
    "Canberra",
    "Albury-Wodonga",
    "Armidale",
    "Ballina",
    "Balranald",
    "Batemans Bay",
    "Bathurst",
    "Bega",
    "Bourke",
    "Bowral",
    "Broken Hill",
    "Byron Bay",
    "Camden",
    "Campbelltown",
    "Cobar",
    "Coffs Harbour",
    "Cooma",
    "Coonabarabran",
    "Coonamble",
    "Cootamundra",
    "Corowa",
    "Cowra",
    "Deniliquin",
    "Dubbo",
    "Forbes",
    "Forster",
    "Glen Innes",
    "Gosford",
    "Goulburn",
    "Grafton",
    "Griffith",
    "Gundagai",
    "Gunnedah",
    "Hay",
    "Inverell",
    "Junee",
    "Katoomba",
    "Kempsey",
    "Kiama",
    "Kurri Kurri",
    "Lake Cargelligo",
    "Lismore",
    "Lithgow",
    "Maitland",
    "Moree",
    "Moruya",
    "Murwillumbah",
    "Muswellbrook",
    "Nambucca Heads",
    "Narrabri",
    "Narrandera",
    "Newcastle",
    "Nowra-Bomaderry",
    "Orange",
    "Parkes",
    "Parramatta",
    "Penrith",
    "Port Macquarie",
    "Queanbeyan",
    "Raymond Terrace",
    "Richmond",
    "Scone",
    "Singleton",
    "Sydney",
    "Tamworth",
    "Taree",
    "Temora",
    "Tenterfield",
    "Tumut",
    "Ulladulla",
    "Wagga Wagga",
    "Wauchope",
    "Wellington",
    "West Wyalong",
    "Windsor",
    "Wollongong",
    "Wyong",
    "Yass",
    "Young",
    "Alice Springs",
    "Anthony Lagoon",
    "Darwin",
    "Katherine",
    "Tennant Creek",
    "Ayr",
    "Beaudesert",
    "Blackwater",
    "Bowen",
    "Brisbane",
    "Buderim",
    "Bundaberg",
    "Caboolture",
    "Cairns",
    "Charleville",
    "Charters Towers",
    "Cooktown",
    "Dalby",
    "Deception Bay",
    "Emerald",
    "Gatton",
    "Gladstone",
    "Gold Coast",
    "Goondiwindi",
    "Gympie",
    "Hervey Bay",
    "Ingham",
    "Innisfail",
    "Kingaroy",
    "Mackay",
    "Mareeba",
    "Maroochydore",
    "Maryborough",
    "Moonie",
    "Moranbah",
    "Mount Isa",
    "Mount Morgan",
    "Moura",
    "Redcliffe",
    "Rockhampton",
    "Roma",
    "Stanthorpe",
    "Toowoomba",
    "Townsville",
    "Warwick",
    "Weipa",
    "Winton",
    "Yeppoon",
    "Adelaide",
    "Ceduna",
    "Clare",
    "Coober Pedy",
    "Gawler",
    "Goolwa",
    "Iron Knob",
    "Leigh Creek",
    "Loxton",
    "Millicent",
    "Mount Gambier",
    "Murray Bridge",
    "Naracoorte",
    "Oodnadatta",
    "Port Adelaide Enfield",
    "Port Augusta",
    "Port Lincoln",
    "Port Pirie",
    "Renmark",
    "Victor Harbor",
    "Whyalla",
    "Beaconsfield",
    "Bell Bay",
    "Burnie",
    "Devonport",
    "Hobart",
    "Kingston",
    "Launceston",
    "New Norfolk",
    "Queenstown",
    "Richmond",
    "Rosebery",
    "Smithton",
    "Stanley",
    "Ulverstone",
    "Wynyard",
    "Albury-Wodonga",
    "Ararat",
    "Bacchus Marsh",
    "Bairnsdale",
    "Ballarat",
    "Beechworth",
    "Benalla",
    "Bendigo",
    "Castlemaine",
    "Colac",
    "Echuca",
    "Geelong",
    "Hamilton",
    "Healesville",
    "Horsham",
    "Kerang",
    "Kyabram",
    "Kyneton",
    "Lakes Entrance",
    "Maryborough",
    "Melbourne",
    "Mildura",
    "Moe",
    "Morwell",
    "Port Fairy",
    "Portland",
    "Sale",
    "Sea Lake",
    "Seymour",
    "Shepparton",
    "Sunbury",
    "Swan Hill",
    "Traralgon",
    "Yarrawonga",
    "Wangaratta",
    "Warragul",
    "Werribee",
    "Wonthaggi",
    "Broome",
    "Bunbury",
    "Busselton",
    "Coolgardie",
    "Dampier",
    "Derby",
    "Fremantle",
    "Geraldton",
    "Kalgoorlie",
    "Kambalda",
    "Katanning",
    "Kwinana",
    "Mandurah",
    "Meekatharra",
    "Mount Barker",
    "Narrogin",
    "Newman",
    "Northam",
    "Perth",
    "Port Hedland",
    "Tom Price",
    "Wyndham"
);
$newZealandCities = array(
    "Auckland",
    "Wellington",
    "Christchurch",
    "Hamilton",
    "Tauranga",
    "Napier",
    "Hastings",
    "Dunedin",
    "Palmerston North",
    "Nelson",
    "Rotorua",
    "New Plymouth",
    "Whangarei",
    "Invercargill",
    "Whanganui",
    "Gisborne",
    "Timaru",
    "Blenheim",
    "Taupo",
    "Pukekohe",
    "Masterton",
    "Levin",
    "Te Awamutu",
    "Matamata",
    "Cambridge",
    "Ashburton",
    "Kaitaia",
    "Kerikeri",
    "Queenstown",
    "Wanaka",
    "Westport",
    "Greymouth",
    "Oamaru",
    "Feilding",
    "Hokitika",
    "Thames",
    "Carterton",
    "Alexandra",
    "Balclutha",
    "Huntly",
    "Putaruru",
    "Paeroa",
    "Te Kuiti",
    "Taumarunui",
    "Te Puke",
    "Waiuku",
    "Wairoa",
    "Dargaville",
    "Kaikoura",
    "Opotiki",
    "Tokoroa",
    "Waihi",
    "Helensville",
    "Cromwell",
    "Whitianga",
    "Kawerau",
    "Katikati",
    "Rangiora",
    "Waipukurau",
    "Warkworth",
    "Wellsford",
    "Marton",
    "Kaikohe",
    "Turangi",
    "Foxton",
    "Ohakune",
    "Tapanui",
    "Lawrence",
    "Milton",
    "Ranfurly",
    "Tirau",
    "Mangakino",
    "Raglan",
    "Kawhia",
    "Waitara",
    "Stratford",
    "Eltham",
    "Hawera",
    "Opunake"
);

// Filter cities based on country
$term = $_GET['term'] ?? '';
$country = $_GET['country'] ?? '';
$cities = [];

if ($country == 'Australia') {
    $cities = array_filter($australianCities, function($city) use ($term) {
        return stripos($city, $term) !== false;
    });
} elseif ($country == 'New Zealand') {
    $cities = array_filter($newZealandCities, function($city) use ($term) {
        return stripos($city, $term) !== false;
    });
} elseif ($country == 'Other') {
    // For other countries, get cities from the database that are not in Australia or New Zealand
    $servername = "localhost";
    $username = "root";
    $password = "";
    $dbname = "test";

    // Create connection
    $conn = new mysqli($servername, $username, $password, $dbname);

    // Check connection
    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
    }

    $sql = "SELECT DISTINCT city FROM products WHERE city LIKE ? AND country NOT IN ('Australia', 'New Zealand')";
    $stmt = $conn->prepare($sql);
    $searchTerm = "%" . $term . "%";
    $stmt->bind_param('s', $searchTerm);
    $stmt->execute();
    $result = $stmt->get_result();

    while ($row = $result->fetch_assoc()) {
        $cities[] = $row['city'];
    }

    $stmt->close();
    $conn->close();
} else {
    // For all countries, get cities from the database
    $servername = "localhost";
    $username = "root";
    $password = "";
    $dbname = "test";

    // Create connection
    $conn = new mysqli($servername, $username, $password, $dbname);

    // Check connection
    if ($conn->connect_error) {
        die("Connection failed: " . $conn->connect_error);
    }

    $sql = "SELECT DISTINCT city FROM products WHERE city LIKE ?";
    $stmt = $conn->prepare($sql);
    $searchTerm = "%" . $term . "%";
    $stmt->bind_param('s', $searchTerm);
    $stmt->execute();
    $result = $stmt->get_result();

    while ($row = $result->fetch_assoc()) {
        $cities[] = $row['city'];
    }

    $stmt->close();
    $conn->close();
}

echo json_encode(array_values($cities));
?>
